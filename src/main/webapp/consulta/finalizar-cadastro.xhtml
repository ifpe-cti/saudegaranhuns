<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
   <h:head>
      <title>Finalizar cadastro de consulta</title>
      <script>
         //<![CDATA[
         var datasString = "#{consultaController.buscarDatasAgendamento()}";
         var datas = datasString.match(/\d{4}-\d{2}-\d{2}/g);
         function disabilitarDias(date) {
            var ano = date.getFullYear();
            //se o mês for menor que 10 adiciona o caracter 0 a esquerda do número
            var mes = (date.getMonth() + 1) < 10 ? ("0" + (date.getMonth() + 1)) : (date.getMonth() + 1);
            //se o dia for menor que 10 adiciona o caracter 0 a esquerda do número
            var dia = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
            var data = ano + "-" + mes + "-" + dia;
            if ($.inArray(data, datas) !== -1) {
               return [true];
            }
            return [false];
         }
         //]]>
      </script>
   </h:head>
   <h:body>
      <h:form>
         <p:fieldset legend="Cadastro de consulta">
            <p:panelGrid columns="2">
               <p:outputLabel value="Data do agendamento" for="dtAgendamento"/>
               <p:calendar value="#{consultaController.consulta.dataAgendamento}" id="dtAgendamento"
                           beforeShowDay="disabilitarDias" converter="localDateConverter" pattern="dd/MM/yyyy"/>
            </p:panelGrid>
            <br/>
            <p:commandButton actionListener="#{consultaController.cadastrar()}" value="Cadastrar"
                             action="listagem.xhtml?faces-redirect=true"/>
            <p:commandButton oncomplete="PF('confDialCancelar').show()" value="Cancelar"/>
         </p:fieldset>
         <p:confirmDialog header="Deseja cancelar?" widgetVar="confDialCancelar"
                          message="Caso escolha cancelar, os dados que não foram salvos, serão
                          perdidos" >
            <p:button href="listagem.xhtml" value="Sim"/>
            <p:commandButton oncomplete="PF('confDialCancelar').hide()" value="Não"/>
         </p:confirmDialog>
      </h:form>
   </h:body>
</html>

